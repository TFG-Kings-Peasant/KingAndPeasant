
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url = env("DATABASE_URL")
}

model User {
  idUser  Int      @id @default(autoincrement())
  name    String   @unique
  email   String   @unique
  password  String
  games   Int      @default(0)
  wins    Int      @default(0)
  losses  Int      @default(0)
  createdAt  DateTime  @default(now())
  lobbiesAsPlayer1  Lobby[]  @relation("Player1")
  lobbiesAsPlayer2  Lobby[]  @relation("Player2")
  friendshipsSent  Friendship[]  @relation("Sender")
  friendshipsReceived  Friendship[]  @relation("Receiver")
}

model Friendship {
  idFriendship  Int  @id @default(autoincrement())
  idSender  Int  
  idReceiver  Int
  sender  User  @relation("Sender", fields: [idSender], references: [idUser])
  receiver User @relation("Receiver", fields: [idReceiver], references: [idUser])  
  status  FriendshipStatus  @default(PENDING)
  @@unique([idSender, idReceiver])
}

model Lobby {
  id     Int      @id @default(autoincrement())
  name  String   @unique
  createdAt   DateTime @default(now())
  status   LobbyStatus @default(WAITING)
  privacy  LobbyPrivacy @default(PUBLIC)
  player1Ready Boolean @default(false)
  player2Ready Boolean @default(false)
  player1Id   Int
  player2Id   Int?
  player1     User     @relation("Player1", fields: [player1Id], references: [idUser])
  player2     User?    @relation("Player2", fields: [player2Id], references: [idUser])
}

enum LobbyPrivacy {
  PUBLIC
  PRIVATE
}

enum LobbyStatus {
  WAITING
  ONGOING
}

enum FriendshipStatus {
  ACCEPTED
  PENDING
  DENIED
}